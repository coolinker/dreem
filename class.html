<html>
<head>
  <title>rhes.es</title>
  <style type="text/css">
    body {
      background-color: rgb(46,36,30);
      background-image: url(img/x2/background-r.png);
      background-size: 259px 259px;
    }
    @font-face {
      font-family: 'wildride';
      src: url('fonts/WildRide.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }
    .trans {
      background-color: rgba(255,255,255,.5);
      width: 80%;
      height: 80%;
      display:none;
    }
    #logo {
      background-repeat: no-repeat;
      width:171;
      height:64;
      position: absolute;
      background-image: url(img/x2/rheses-color.png);
      background-repeat: no-repeat;
      background-size: 171px 64px;
    }
    #slogan {
      font-family: wildride;
      white-space: nowrap;
      color: rgb(154,123,75);
      font-size: 72px;
      position: absolute;
      text-shadow: 0px 0px 4px rgb(46,36,30);
    }
  </style>
  <script type="text/javascript" src="jquery-1.9.1.min.js"></script>
  <script type="text/javascript" src="acorn.js"></script>
  <script type="text/javascript" src="underscore.js"></script>
  <script type="text/javascript" src="layout.js"></script>
  <script type="text/javascript" src="coffee-script.js"></script>
</head>
<body>
  <view id="container" y="300" width="100" height="100">
    <class name="simplelayout" extends="layout" type="coffee">
      <attribute name="attribute" type="string" value="x"></attribute>
      <attribute name="inset" type="number" value="10"></attribute>
      <attribute name="spacing" type="number" value="15"></attribute>
      <attribute name="axis" type="string" value="width"></attribute>
      <handler name="oninit">
        # console.log('oninit', this)
      </handler>
      <handler name="oninset" args="inset">
      	this.inset = inset
        # console.log('oninset', inset)
      </handler>
      <handler name="onsubview" args="subview">
        # console.log('onsubview', this.axis, this.update, subview, this)
        subview.bind(this.axis, this.update)
      </handler>
      <setter name="spacing" args="spacing">
        this.spacing = spacing
        # console.log('spacing setter', spacing, this)
        this.update()
      </setter>
      <setter name="attribute" args="attr">
        newaxis = switch attr
          when 'x' then 'width' 
          when 'y' then 'height'

        # console.log 'coffee', attr, arguments, @, @parent 
        unless @skip() 
          for subview in @parent.subviews
            subview.unbind(@axis, @update).bind(newaxis, @update)

        @axis = newaxis

        @attribute = attr
        # console.log('set_attribute', attr, typeof attr, @attribute, @axis, newaxis)
        @update()
      </setter>
      <method name="update" args="value, sender">
        # console.log('skip', @skip, @locked)
        return if @skip()
        pos = @inset ? 0 
        skip = true if sender
        for subview in @parent.subviews
          if (skip and subview != sender)
            # console.log 'skipping', subview, sender
          else 
            # console.log 'updating', subview, @attribute, pos
            subview.setAttribute(@attribute, pos) unless subview[@attribute] == pos
            skip = false
          # console.log 'value', pos, @spacing, @inset, @attribute, @axis, subview, subview[@axis]
          pos += @spacing + subview[@axis] 
        return pos
      </method>
    </class>
    <simplelayout name="lay" spacing="42">
      <handler name="oninit">
        //# console.log('oninit instance', this)
        this.hello('a', 'b', 'c')
      </handler>
      <method name="hello" args="a,b,c">
        //# console.log('hello instance', a,b,c, this)
      </method>
    </simplelayout>
    <view width="10" height="10" bgcolor="red"></view>
    <view width="10" height="10" bgcolor="yellow"></view>
    <view width="10" height="10" bgcolor="green" id="grn"></view>
    <view width="10" height="10" bgcolor="black"></view>
    <view width="10" height="10" bgcolor="blue"></view>
  </view>
</body>
</html>