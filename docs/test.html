<html lang="en">

  <head>
    <title>Dreem in 10</title>
    <script type="text/javascript" src="/lib/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="/lib/acorn.js"></script>
    <script type="text/javascript" src="/lib/coffee-script.js"></script>
    <script type="text/javascript" src="/layout.js"></script>
  </head>

  <body>

  <view id="all" width="${lz.window.width}" height="${lz.window.height}" clip="true">

    <view name="lesson" width="${this.parent.width/4}" height="${this.parent.height}" bgcolor="#e0e0e0">
      <text text="Execute button" bgcolor="green">
        <handler name="onclick">
          prefix = 
	    ['&lt;view id="all" width="600" height="600" clip="true">'].join('\n');

	  postfix = 
	    ['&lt;/view>',
	     '&lt;script>$(function(){window.frames[0].lz.initElements()});&lt;/script>'].join('\n');

          contents = this.parent.parent.editor.text;
	  fullcontents = prefix + contents + postfix;
          fullcontents = fullcontents.replace('&lt;', '<');
          this.parent.parent.renderFrame.setAttribute('contents', fullcontents);
        </handler>
      </text>
      <text x="0" y="40" name="description" width="${this.parent.width}" height="${this.parent.height-this.y}" bgcolor="#a0a0a0" multiline="true">
      </text>
    </view>


    <ace name="editor" x="${this.parent.width/4}" width="${this.parent.width/2}" height="${this.parent.height}" text="" bgcolor="#808080">
      <handler name="onwidth">
        // console.log("ace: ", this.width, this.height);
      </handler>
      <handler name="onheight">
        // console.log("ace: ", this.width, this.height);
      </handler>
    </ace>

    <dreem_iframe name="renderFrame" x="${this.parent.width*3/4}" width="${this.parent.width/4}" height="${this.parent.height}" bgcolor="#e0e0e0">
    </dreem_iframe>


    <!-- Hack to initialize editor -->
    <view width="0" height="0">
      <handler name="oninit">
        var $view = this.parent;

	console.log(this);

        var page = 0
        var lesson = 'din10'

        //TODO Ask max how to do this with dataset object.
        // Show description
        $.get("/docs/" + lesson + "/description_" + page + ".html", function(data) {
          $view.lesson.description.setAttribute('text', data);
        });

        // Show code
        $.get("/docs/" + lesson + "/code_" + page + ".html", function(data) {
          $view.editor.setAttribute('text', data);
        });
      </handler>
    </view>

  </view>
  </body>
</html>
