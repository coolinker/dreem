var rheses=function(){var n,e,t,o,r,i,s,a,u,c,f,p,d,l,h=!1,m=".rheses",w=$.style;return $.style=function(n,e,t){var o,r=w.apply(this,arguments);return void 0===t||h||(o=$.data(n,"sendstyle"),o&&o[e]&&$(n).trigger(e+m)),r},n=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(n){setTimeout(n,17)},Mouse=function(){var e=0,t=0,o=null,r=$(this),i=$(document),s=function(){r.trigger("move")},a=function(r){o&&n(s),e=r.pageX,t=r.pageY},u=function(){o||(o=!0,i.on("mousemove",a).one("mouseout",c))},c=function(){o&&(o=!1,i.off("mousemove",a).one("mouseover",u))},f=function(){return{top:t,left:e}},p={start:u,stop:c,position:f,offset:f,selector:r};return p}(),e={top:"position().top",left:"position().left",width:"width()",height:"height()",parent:"parent()"},t={scope:"this"},t.process=function(n){var e=function(n){for(;n.object&&"MemberExpression"===n.object.type;)n=n.object;return n.object||n},t=function(n,t){var o=e(n),r=o.name;t&&(o.name="$("+t+")","this"===t&&(o.name+="."+r))};this.scope="this",acorn.walkDown(n,this),t(n,this.scope)},t.Identifier=function(n){var o,r=n.name;r in e?n.name=e[r]:r in window&&(o=window[r],t.scope=o instanceof HTMLElement?"'#"+r+"'":o===window||o===document?r:null)},t.ThisExpression=function(n){n.type="Identifier",n.name="$(this)",t.scope=null},o={},o.MemberExpression=function(n){return t.process(n),!0},r={},r.MemberExpression=function(n){if("function"==typeof window[n.object.name])return!0;var e=n.property.name;return n=n.object,t.process(n),r.foundScopes.push({scope:acorn.stringify(n),propname:e}),!0},findScopes=function(n){var e=acorn.parse(n);return r.foundScopes=[],acorn.walkDown(e,r),r.foundScopes},i=function(n){var e;try{e=acorn.parse(n)}catch(t){return console.error("Failed to parse",n,"for",cssprop,"of",el),!1}return acorn.walkDown(e,o),acorn.stringify(e)},s=function(n,e){return Function([],n).bind(e)},a=function(n,e,t){function o(n,e){e.on(n+m,a.update),p.push(e)}var r,a,c,f,p,d;return parsedExpression=i(t),r=$.data(n,"constraints")||{},$.data(n,"constraints",r),r[e]&&u(n,e),r[e]||(r[e]={scopes:[]}),a=r[e],c=$(n),f=s("return "+parsedExpression,c),a.update=function(){return h?void 0:(c.css(e,f()),!1)},p=a.scopes,d={},findScopes(t).forEach(function(r){var i,a,u,f,p=r.scope,l=r.propname,h=p+"."+l;if(!d[h]&&(i=s("return "+p,c)(),0!==i.length)){if(i.length>1&&console.warn('"'+p+'" may have an error. Found multiple scopes, only using the first in: ',i),a=i&&i[0],a===n&&l===e)return console.warn('Not binding: expression "'+t+'" may have an error binding to own property',e,"on element",n),void 0;d[h]=!0,u=a&&(a===window||"body"===a.localName),!u||"width"!==l&&"height"!==l?i===Mouse&&(Mouse.start(),o("move",Mouse.selector)):o("resize",$(window)),a instanceof HTMLElement&&(f=$.data(a,"sendstyle"),f||(f=$.data(a,"sendstyle",{})),f[l]=!0,o(l,i))}}),a.update(),this},u=function(n,e){var t,o,r,i,s,a,u=$.data(n,"constraints");if(u){for(t=u&&u[e],o=t.update,r=t.scopes,i=0,s=r.length;s>i;i++)a=r[i],a.off(m,o);delete u[e]}},c="[r-style]",f=function(n,e){return n=n||c,$(n).each(function(n,t){var o,r;if(void 0===e){if(o=$.data(t,"constraints"))for(r in o)u(t,r)}else u(t,e)}),this},p=function(n){return n=n||c,$(n).each(function(n,e){var t=e.getAttribute("r-style"),o=t.split(";");o.forEach(function(n){var t,o,r;n&&(t=n.indexOf(":"),o=n.substr(0,t).replace(/ /g,""),r=n.substr(t+1),a(e,o,r))})}),this},d=function(n){return n=n||c,$(n).each(function(n,e){var t,o=$.data(e,"constraints");if(!o)return!1;for(t in o)o[t].update()}),this},l=function(n){return h=!n,n&&d(),this},$(window).on("load",function(){p()}),{applyConstraint:a,unbindConstraints:f,bindConstraints:p,setEnabled:l,updateConstraints:d}}();