var rheses=function(n){var t,e,o,r,i,s,a,u,c,f,p,d,l,h,m,w=!1,g=".rheses",v=n.fn.css;return n.fn.css=function(){var t,e,o,r,i,s,a;if(v.apply(this,arguments),!w)for(t={},e=arguments[0],"object"!=typeof e?t[e]=arguments[1]:t=e,o=n(this),r=0,i=o.length;i>r;r++)if(s=n.data(o[r],"sendstyle"))for(a in t)s[a]&&o.trigger(a+g);return this},t=n.fn.animate,n.fn.animate=function(){var e,o,r=Array.prototype.slice.call(arguments,0);return w||("object"!=typeof r[1]&&(r[1]={duration:r[1],easing:r[2],complete:r[3]},r.length=2),e=r[1].step,o=n(this),r[1].step=function(t,r){var i,s;e&&e.call(this,arguments),i=r.prop,s=n.data(this,"sendstyle"),s&&s[i]&&o.trigger(i+g)}),t.apply(this,r)},e=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(n){setTimeout(n,17)},Mouse=function(){var t=0,o=0,r=null,i=!1,s=null,a=function(){r&&e(a),i&&(i=!1,s.trigger("move"))},u=function(n){t=n.pageX,o=n.pageY,i=!0},c=n(document),f=function(){r||(null===r&&(s=l.selector=n(Mouse)),r=!0,e(a),c.on("mousemove",u),c.one("mouseout",p))},p=function(){r&&(r=!1,c.off("mousemove",u),c.one("mouseover",f))},d=function(){return{top:o,left:t}},l={start:f,stop:p,position:d,offset:d};return l}(),o={top:"position().top",left:"position().left",width:"width()",height:"height()",parent:"parent()"},r={scope:"this"},r.process=function(n){var t=function(n){for(;n.object&&"MemberExpression"===n.object.type;)n=n.object;return n.object||n},e=function(n,e){var o=t(n),r=o.name;e&&(o.name="$("+e+")","this"===e&&(o.name+="."+r))};this.scope="this",acorn.walkDown(n,this),e(n,this.scope)},r.Identifier=function(n){var t,e=n.name;e in o?n.name=o[e]:e in window&&(t=window[e],r.scope=t instanceof HTMLElement?"'#"+e+"'":t===window||t===document?e:null)},r.ThisExpression=function(n){n.type="Identifier",n.name="$(this)",r.scope=null},i={},i.MemberExpression=function(n){return r.process(n),!0},s={},s.MemberExpression=function(n){if("function"==typeof window[n.object.name])return!0;var t=n.property.name;return n=n.object,r.process(n),s.foundScopes.push({scope:acorn.stringify(n),propname:t}),!0},findScopes=function(n){var t=acorn.parse(n);return s.foundScopes=[],acorn.walkDown(t,s),s.foundScopes},a=function(n){var t;try{t=acorn.parse(n)}catch(e){return console.error("Failed to parse",n,"for",cssprop,"of",el),!1}return acorn.walkDown(t,i),acorn.stringify(t)},u=function(n,t){return Function([],n).bind(t)},c=function(t,e,o){function r(n,t){t.on(n+g,s.update),d.push(n,t)}var i,s,c,p,d,l;return parsedExpression=a(o),i=n.data(t,"constraints")||{},n.data(t,"constraints",i),i[e]&&f(t,e),i[e]||(i[e]={scopes:[]}),s=i[e],c=n(t),p=u("return "+parsedExpression,c),s.update=function(){return w?void 0:(c.css(e,p()),!1)},d=s.scopes,l={},findScopes(o).forEach(function(i){var s,a,f,p,d=i.scope,h=i.propname,m=d+"."+h;if(!l[m]&&(s=u("return "+d,c)(),0!==s.length)){if(s.length>1&&console.warn('"'+d+'" may have an error. Found multiple scopes, only using the first in: ',s),a=s&&s[0],a===t&&h===e)return console.warn('Not binding: expression "'+o+'" may have an error binding to own property',e,"on element",t),void 0;l[m]=!0,f=a&&(a===window||"body"===a.localName),!f||"width"!==h&&"height"!==h?s===Mouse&&(Mouse.start(),r("move",Mouse.selector)):r("resize",n(window)),a instanceof HTMLElement&&(p=n.data(a,"sendstyle"),p||(p=n.data(a,"sendstyle",{})),p[h]=!0,r(h,s))}}),s.update(),this},f=function(t,e){var o,r,i,s,a,u,c,f=n.data(t,"constraints");if(f){for(o=f&&f[e],r=o.update,i=o.scopes,s=0,a=i.length;a>s;s+=2)u=i[s+1],c=i[s],n(u).off(c,r);delete f[e]}},p="[r-style]",d=function(t,e){return t=t||p,n(t).each(function(t,o){var r,i;if(void 0===e){if(r=n.data(o,"constraints"))for(i in r)f(o,i)}else f(o,e)}),this},l=function(t){return t=t||p,n(t).each(function(n,t){var e=t.getAttribute("r-style"),o=e.split(";");o.forEach(function(n){var e,o,r;n&&(e=n.indexOf(":"),o=n.substr(0,e).replace(/ /g,""),r=n.substr(e+1),c(t,o,r))})}),this},h=function(t){return t=t||p,n(t).each(function(t,e){var o,r=n.data(e,"constraints");if(!r)return!1;for(o in r)r[o].update()}),this},m=function(n){return w=!n,n&&h(),this},n(window).on("load",function(){l()}),{applyConstraint:c,unbindConstraints:d,bindConstraints:l,setEnabled:m,updateConstraints:h}}(jQuery);