var requestTick=function(){var n=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(n){setTimeout(n,17)},t=!1,e={},o=function(){for(var n in e)e[n]&&(e[n](),e[n]=null);t=!1};return function(r,i){t||n(o),t=!0,e[r]=i}}(),Mouse=function(n){var t=0,e=0,o=null,r=n(this),i=n(document),s=function(){r.trigger("move")},u=function(n){o&&requestTick(0,s),t=n.pageX,e=n.pageY},a=function(){o||(o=!0,i.on("mousemove",u).one("mouseout",c))},c=function(){o&&(o=!1,i.off("mousemove",u).one("mouseover",a))},f=function(){return{top:e,left:t}},p={start:a,stop:c,position:f,offset:f,selector:r};return p}(jQuery),rheses=function(n,t,e,o){var r,i,s,u,a,c,f,p,d,l,h,m,w,v,y,b=!1,g=window.console||function(){},E=".rheses",j=n.style;return n.style=function(t,e,o){var r,i=j.apply(this,arguments);return void 0===o||b||(r=n.data(t,"sendstyle"),r&&r[e]&&n(t).trigger(e+E)),i},r={top:"position().top",left:"position().left",width:"width()",height:"height()",parent:"parent()"},i={scope:"this"},i.process=function(n){var e=function(n){for(;n.object&&"MemberExpression"===n.object.type;)n=n.object;return n.object||n},o=function(n,t){var o=e(n),r=o.name;t&&(o.name="$("+t+")","this"===t&&(o.name+="."+r))};this.scope="this",t.walkDown(n,this),o(n,this.scope)},i.Identifier=function(n){var t,e=n.name;e in r?n.name=r[e]:e in window&&(t=window[e],i.scope=t instanceof HTMLElement?"'#"+e+"'":t===window||t===document?e:null)},i.ThisExpression=function(n){n.type="Identifier",n.name="$(this)",i.scope=null},s={},s.MemberExpression=function(n){return i.process(n),!0},u={},u.MemberExpression=function(n){if("function"==typeof window[n.object.name])return!0;var e=n.property.name;return n=n.object,i.process(n),u.foundScopes.push({scope:t.stringify(n),propname:e}),!0},a=function(n){var e=t.parse(n);return u.foundScopes=[],t.walkDown(e,u),u.foundScopes},c=function(n){var e;try{e=t.parse(n)}catch(o){return g.error("Failed to parse",n),!1}return t.walkDown(e,s),t.stringify(e)},f=function(n,t){return Function([],n).bind(t)},p=1,d=function(t,r,i){function s(n,t){t.on(n+E,u.update),u.scopes.push(t)}var u,d,h,m,w,v,y=c(i),j=n.data(t,"constraints")||{};return n.data(t,"constraints",j),j[r]&&l(t,r),j[r]||(j[r]={scopes:[]}),u=j[r],d=n(t),h=f("return "+y,d),m=function(){d.css(r,h())},w=p++,u.update=function(){return b?void 0:(o(w,m),!1)},v={},a(i).forEach(function(o){var u,a,c,p,l=o.scope,h=o.propname,m=l+"."+h;if(!v[m]&&(u=f("return "+l,d)(),0!==u.length)){if(u.length>1&&g.warn('"'+l+'" may have an error. Found multiple scopes, only using the first in: ',u),a=u&&u[0],a===t&&h===r)return g.warn('Not binding: expression "'+i+'" may have an error binding to own property',r,"on element",t),void 0;v[m]=!0,c=a&&(a===window||"body"===a.localName),!c||"width"!==h&&"height"!==h?u===e&&(e.start(),s("move",e.selector)):s("resize",n(window)),a instanceof HTMLElement&&(p=n.data(a,"sendstyle"),p||(p=n.data(a,"sendstyle",{})),p[h]=!0,s(h,u))}}),u.update(),this},l=function(t,e){var o,r,i,s,u,a,c=n.data(t,"constraints");if(c){for(o=c&&c[e],r=o.update,i=o.scopes,s=0,u=i.length;u>s;s++)a=i[s],a.off(E,r);delete c[e]}},h="[r-style]",m=function(t,e){return t=t||h,n(t).each(function(t,o){var r,i;if(void 0===e){if(r=n.data(o,"constraints"))for(i in r)l(o,i)}else l(o,e)}),this},w=function(t){return t=t||h,n(t).each(function(n,t){var e=t.getAttribute("r-style"),o=e.split(";");o.forEach(function(n){var e,o,r;n&&(e=n.indexOf(":"),o=n.substr(0,e).replace(/ /g,""),r=n.substr(e+1),d(t,o,r))})}),this},v=function(t){return t=t||h,n(t).each(function(t,e){var o,r=n.data(e,"constraints");if(!r)return!1;for(o in r)r[o].update()}),this},y=function(n){return b=!n,n&&v(),this},n(window).on("load",function(){w()}),{applyConstraint:d,unbindConstraints:m,bindConstraints:w,setEnabled:y,updateConstraints:v}}(jQuery,acorn,Mouse,requestTick);