var rheses=function(n){var t,e,o,r,s,i,a,u,c,f,p,d,l,h,m,g,w=!1,v=".rheses",y=n.fn.css;return n.fn.css=function(){var t,e,o,r,s,i,a;if(y.apply(this,arguments),!w)for(t={},e=arguments[0],"object"!=typeof e?t[e]=arguments[1]:t=e,o=n(this),r=0,s=o.length;s>r;r++)if(i=n.data(o[r],"sendstyle"))for(a in t)i[a]&&o.trigger(a+v);return this},t=n.fn.animate,n.fn.animate=function(){var e,o,r=Array.prototype.slice.call(arguments,0);return w||("object"!=typeof r[1]&&(r[1]={duration:r[1],easing:r[2],complete:r[3]},r.length=2),e=r[1].step,o=n(this),r[1].step=function(t,r){var s,i;e&&e.call(this,arguments),s=r.prop,i=n.data(this,"sendstyle"),i&&i[s]&&o.trigger(s+v)}),t.apply(this,r)},e=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(n){setTimeout(n,17)},Mouse=function(){var t=0,o=0,r=null,s=!1,i=null,a=function(){r&&e(a),s&&(s=!1,i.trigger("move"))},u=function(n){t=n.pageX,o=n.pageY,s=!0},c=n(document),f=function(){r||(null===r&&(i=l.selector=n(Mouse)),r=!0,e(a),c.on("mousemove",u),c.one("mouseout",p))},p=function(){r&&(r=!1,c.off("mousemove",u),c.one("mouseover",f))},d=function(){return{top:o,left:t}},l={start:f,stop:p,position:d,offset:d};return l}(),o={top:"position().top",left:"position().left",width:"width()",height:"height()",parent:"parent()"},r={scope:"this"},r.process=function(n){var t=function(n){for(;n.object&&"MemberExpression"===n.object.type;)n=n.object;return n.object||n},e=function(n,e){var o=t(n),r=o.name;e&&(o.name="$("+e+")","this"===e&&(o.name+="."+r))};this.scope="this",acorn.walkDown(n,this),e(n,this.scope)},r.Identifier=function(n){var t,e=n.name;e in o?n.name=o[e]:e in window&&(t=window[e],r.scope=t instanceof HTMLElement?"'#"+e+"'":t===window||t===document?e:null)},r.ThisExpression=function(n){n.type="Identifier",n.name="$(this)",r.scope=null},s={},s.MemberExpression=function(n){return r.process(n),!0},i={foundScopes:[]},a={Math:!0},i.MemberExpression=function(n){if(n.object.name in a)return!0;var t=n.property.name;return n=n.object,r.process(n),i.foundScopes.push({scope:acorn.stringify(n),propname:t}),!0},findScopes=function(n){var t=acorn.parse(n);return i.foundScopes=[],acorn.walkDown(t,i),i.foundScopes},u=function(n,t){return Function([],n).bind(t)},c=function(n){var t;try{t=acorn.parse(n)}catch(e){return console.error("Failed to parse",n,"for",cssprop,"of",el),!1}return acorn.walkDown(t,s),acorn.stringify(t)},f=function(t,e,o){function r(n,t){t.on(n+v,i.update),p.push(n,t)}var s,i,a,f,p,d;return parsedExpression=c(o),s=n.data(t,"constraints")||{},n.data(t,"constraints",s),s[e]?!1:(s[e]={scopes:[]},i=s[e],a=n(t),f=u("return "+parsedExpression,a),i.update=function(n){n&&n.stopPropagation(),w||a.css(e,f())},p=i.scopes,d={},findScopes(o).forEach(function(s){var i,c,f,p,l=s.scope,h=s.propname,m=l+"."+h;if(!d[m]&&(i=u("return "+l,a)(),0!==i.length)){if(i.length>1&&console.warn('"'+l+'" may have an error. Found multiple scopes, only using the first in: ',i),c=i&&i[0],c===t&&h===e)return console.warn('Not binding: expression "'+o+'" may have an error binding to own property',e,"on element",t),void 0;d[m]=!0,f=c&&(c===window||"body"===c.localName),!f||"width"!==h&&"height"!==h?i===Mouse&&(Mouse.start(),r("move",Mouse.selector)):r("resize",n(window)),c instanceof HTMLElement&&(p=n.data(c,"sendstyle"),p||(p=n.data(c,"sendstyle",{})),p[h]=!0,r(h,i))}}),i.update(),this)},p=function(t,e){var o,r,s,i,a,u,c,f=n.data(t,"constraints");if(f){for(o=f&&f[e],r=o.update,s=o.scopes,i=0,a=s.length;a>i;i+=2)u=s[i+1],c=s[i],n(u).off(c,r);delete f[e]}},d="[r-style]",l=function(t,e){return t=t||d,n(t).each(function(t,o){var r,s;if(void 0===e){if(r=n.data(o,"constraints"))for(s in r)p(o,s)}else p(o,e)}),this},h=function(t){return t=t||d,n(t).each(function(n,t){var e=t.getAttribute("r-style"),o=e.split(";");o.forEach(function(n){var e,o,r;n&&(e=n.indexOf(":"),o=n.substr(0,e).replace(/ /g,""),r=n.substr(e+1),f(t,o,r))})}),this},m=function(t){return t=t||d,n(t).each(function(t,e){var o,r=n.data(e,"constraints");if(!r)return!1;for(o in r)r[o].update()}),this},g=function(n){return w=!n,n&&m(),this},n(window).on("load",function(){h()}),{applyConstraint:f,unbindConstraints:l,bindConstraints:h,setEnabled:g,updateConstraints:m}}(jQuery);