var requestTick=function(){var n=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(n){setTimeout(n,17)},t=!1,e={},r=function(){for(var n in e)e[n]&&(e[n](),e[n]=null);t=!1};return function(o,i){t||n(r),t=!0,e[o]=i}}(),Mouse=function(n){var t=0,e=0,r=null,o=n(this),i=n(document),s=function(){o.trigger("move")},a=function(n){r&&requestTick(0,s),t=n.pageX,e=n.pageY},u=function(){r||(r=!0,i.on("mousemove",a).one("mouseout",c))},c=function(){r&&(r=!1,i.off("mousemove",a).one("mouseover",u))},f=function(){return{top:e,left:t}},p={start:u,stop:c,position:f,offset:f,selector:o};return p}(jQuery),rheses=function(n,t,e,r){var o=!1,i=window.console||function(){},s=".rheses",a=n.style;n.style=function(t,e,r){var i=a.apply(this,arguments);if(void 0!==r&&!o){var u=n.data(t,"sendstyle");u&&u[e]&&n(t).trigger(e+s)}return i};var u={top:"position().top",left:"position().left",width:"width()",height:"height()",parent:"parent()"},c={scope:"this"};c.process=function(n){var e=function(n){for(;n.object&&"MemberExpression"===n.object.type;)n=n.object;return n.object||n},r=function(n,t){var r=e(n),o=r.name;t&&(r.name="$("+t+")","this"===t&&(r.name+="."+o))};this.scope="this",t.walkDown(n,this),r(n,this.scope)},c.Identifier=function(n){var t=n.name;if(t in u)n.name=u[t];else if(t in window){var e=window[t];c.scope=e instanceof HTMLElement?"'#"+t+"'":e===window||e===document?t:null}},c.ThisExpression=function(n){n.type="Identifier",n.name="$(this)",c.scope=null};var f={};f.MemberExpression=function(n){return c.process(n),!0},f.Identifier=function(n){return c.process(n),!0};var p={},d=function(n,e){return c.process(n),p.foundScopes.push({scope:t.stringify(n),propname:e}),!0};p.MemberExpression=function(n){if("function"==typeof window[n.object.name])return!0;var t=n.property.name;return n=n.object,d(n,t)},p.Identifier=function(n){var t=n.name;return d(n,t)};var v=function(n){var e=t.parse(n);return p.foundScopes=[],t.walkDown(e,p),p.foundScopes},l=function(n){var e;try{e=t.parse(n)}catch(r){return i.error("Failed to parse",n),!1}return t.walkDown(e,f),t.stringify(e)},h=function(n,t){return Function([],n).bind(t)},m=1,w=function(t,a,u){function c(n,t){t.on(n+s,d.update),d.scopes.push(t)}var f=l(u),p=n.data(t,"constraints")||{};n.data(t,"constraints",p),p[a]&&y(t,a),p[a]||(p[a]={scopes:[]});var d=p[a],w=n(t),b=h("return "+f,w),g=function(){w.css(a,b())},E=m++;d.update=function(){return o?void 0:(r(E,g),!1)};var j={};return v(u).forEach(function(r){var o=r.scope,s=r.propname,f=o+"."+s;if(!j[f]){var p=h("return "+o,w)();if(0!==p.length){p.length>1&&i.warn('"'+o+'" may have an error. Found multiple scopes, only using the first in: ',p);var d=p&&p[0];if(d===t&&s===a)return i.warn('Not binding: expression "'+u+'" may have an error binding to own property',a,"on element",t),void 0;j[f]=!0;var v=d&&(d===window||"body"===d.localName);if(!v||"width"!==s&&"height"!==s?p===e&&(e.start(),c("move",e.selector)):c("resize",n(window)),d instanceof HTMLElement){var l=n.data(d,"sendstyle");l||(l=n.data(d,"sendstyle",{})),l[s]=!0,c(s,p)}}}}),d.update(),this},y=function(t,e){var r=n.data(t,"constraints");if(r){for(var o=r&&r[e],i=o.update,a=o.scopes,u=0,c=a.length;c>u;u++){var f=a[u];f.off(s,i)}delete r[e]}},b="[r-style]",g=function(t,e){return t=t||b,n(t).each(function(t,r){if(void 0===e){var o=n.data(r,"constraints");if(o)for(var i in o)y(r,i)}else y(r,e)}),this},E=function(t){return t=t||b,n(t).each(function(n,t){var e=t.getAttribute("r-style"),r=e.split(";");r.forEach(function(n){if(n){var e=n.indexOf(":"),r=n.substr(0,e).replace(/ /g,""),o=n.substr(e+1);w(t,r,o)}})}),this},j=function(t){return t=t||b,n(t).each(function(t,e){var r=n.data(e,"constraints");if(!r)return!1;for(var o in r)r[o].update()}),this},k=function(n){return o=!n,n&&j(),this};return n(window).on("load",function(){E()}),{applyConstraint:w,unbindConstraints:g,bindConstraints:E,setEnabled:k,updateConstraints:j}}(jQuery,acorn,Mouse,requestTick);