<html>
<head>
  <title>dr33m</title>
  <style type="text/css">
    body {
      background-color: white;
      font-family: 'Helvetica';
      font-size: 36px;
      margin: 0px;
      padding: 0px;
      font-size: 14px;
    }
    input {
      font-family: 'Helvetica';
      font-size: 14px;
      margin: 0px;
      padding: 0px;
      width: 100px;
    }
  </style>
  <script type="text/javascript" src="lib/jquery-1.9.1.js"></script>
  <script type="text/javascript" src="lib/acorn.js"></script>
  <script type="text/javascript" src="lib/coffee-script.js"></script>
  <script type="text/javascript" src="layout.js"></script>
  <script src="http://threejs.org/build/three.min.js"></script>
  <script src="http://threejs.org/examples/js/controls/OrbitControls.js"></script>
  <script src="http://threejs.org/examples/js/libs/stats.min.js"></script>
</head>
<body>
  <view>
    <audioplayer id="audio" url="music/03_Homage Sliders.mp3" fftsize="2048" fftsmoothing="0.1" playing="true"></audioplayer>

    <class name="audioviz" width="100" height="100">
      <attribute name="data" value="[]" type="expression"></attribute>
      <handler name="oninit">
        this.cubes = [];

        container = this.sprite.el;

        camera = new THREE.PerspectiveCamera( 70, this.width / this.height, 1, 10000 );
        camera.position.x = -448
        camera.position.z = 417

        scene = new THREE.Scene();

        var light = new THREE.DirectionalLight( 0xffffff, 2 );
        light.position.set( 1, 1, 1 ).normalize();
        scene.add( light );

        var light = new THREE.DirectionalLight( 0xffffff );
        light.position.set( -1, -1, -1 ).normalize();
        scene.add( light );

        var geometry = new THREE.BoxGeometry( 20, 20, 20 );

        for ( var i = 0; i < 1024; i ++ ) {
          var object = new THREE.Mesh( geometry, new THREE.MeshLambertMaterial( { color: Math.random() * 0xffffff } ) );
          object.position.x = (i * 22) - 400;
          this.cubes.push(object);
          scene.add( object );
        }

        renderer = new THREE.WebGLRenderer();
        renderer.setClearColor( this.bgcolor );
        renderer.setSize( this.width, this.height);
        renderer.sortObjects = false;
        container.appendChild(renderer.domElement);

        controls = new THREE.OrbitControls(camera);
        controls.addEventListener( 'change', this.render );
      </handler>
      <handler name="onidle" reference="lz.idle">
        this.render();
      </handler>
      <method name="render">
        var scale = 1;
        if (this.data.length) {
          for (var i = 0; i < 1024; i++) {
            scale = (this.data[i] / 16) + 1;
            if (! isNaN(scale)) {
              if (scale < 1) scale = 1
              this.cubes[i].scale.y = scale;
              this.cubes[i].scale.z = scale;
            }
          }
        }

        renderer.render( scene, camera );
      </method>
      <handler name="onwidth" method="resize"></handler>
      <handler name="onheight" method="resize"></handler>
      <method name="resize">
        if (camera) {
          camera.aspect = window.innerWidth / window.innerHeight;
          camera.updateProjectionMatrix();
        }
        if (renderer) {
          renderer.setSize( this.width, this.height);
        }
      </method>
    </class>

    <audioviz width="${lz.window.width}" height="${lz.window.height}" bgcolor="white" data="${audio.fft}"></audioviz>

    <stats></stats>
  </view>
</body>
</html>