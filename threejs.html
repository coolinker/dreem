<html>
<head>
  <title>dr33m</title>
  <style type="text/css">
    body {
      background-color: white;
      font-family: 'Helvetica';
      font-size: 36px;
      margin: 0px;
      padding: 0px;
      font-size: 14px;
    }
    input {
      font-family: 'Helvetica';
      font-size: 14px;
      margin: 0px;
      padding: 0px;
      width: 100px;
    }
  </style>
  <script type="text/javascript" src="lib/jquery-1.9.1.js"></script>
  <script type="text/javascript" src="lib/acorn.js"></script>
  <script type="text/javascript" src="lib/coffee-script.js"></script>
  <script type="text/javascript" src="layout.js"></script>
</head>
<body>
  <view>
    <audioplayer id="audio" url="music/03_Homage Sliders.mp3" fftsize="2048" fftsmoothing="0.1" playing="true"></audioplayer>

    <class name="threejsviz" extends="threejs" scriptincludes="http://threejs.org/examples/js/controls/OrbitControls.js">
      <attribute name="data" value="[]" type="expression"></attribute>
      <attribute name="objects" value="[]" type="expression"></attribute>
      <handler name="ondata" args="data">
        for (var i = 0; i < this.objects.length; i++) {
          this.applyData(this.objects[i], data[i]);
        }
        this.render()
      </handler>
      <method name="applyData" args="object, datum">
      </method>
    </class>

    <threejsviz width="${lz.window.width}" height="${lz.window.height}" bgcolor="white" data="${audio.fft}">
      <method name="initScene" args="scene">
        this.camera.position.x = -448
        this.camera.position.z = 417

        var controls = new THREE.OrbitControls(this.camera);
        controls.addEventListener('change', this.render);

        var light = new THREE.DirectionalLight( 0xffffff, 2 );
        light.position.set( 1, 1, 1 ).normalize();
        scene.add( light );

        light = new THREE.DirectionalLight( 0xffffff );
        light.position.set( -1, -1, -1 ).normalize();
        scene.add( light );

        var geometry = new THREE.BoxGeometry( 20, 20, 20 );

        for ( var i = 0; i < 2048; i ++ ) {
          var object = new THREE.Mesh( geometry, new THREE.MeshLambertMaterial( { color: Math.random() * 0xffffff } ) );
          object.position.x = (i * 22) - 400;
          this.objects.push(object);
          scene.add( object );
        }
      </method>
      <method name="applyData" args="object, datum">
        if (isNaN(datum)) return;
        var scale = ((datum / 256) * 16) + 1;
        object.scale.y = scale;
        object.scale.z = scale;
      </method>
    </threejsviz>

    <stats></stats>
  </view>
</body>
</html>